// Session service
import { Session } from '../entities/Session';
import { v4 as uuidv4 } from 'uuid';

// In-memory session store (replace with DB in prod)
const sessions: Session[] = [];

export const sessionService = {
  async create(userId: string, token: string, expiresAt: Date): Promise<Session> {
    const session: Session = {
      id: uuidv4(),
      userId,
      token,
      expiresAt,
      createdAt: new Date(),
    };
    sessions.push(session);
    return session;
  },
  async findByToken(token: string): Promise<Session | undefined> {
    return sessions.find(s => s.token === token && s.expiresAt > new Date());
  },
  async invalidate(token: string): Promise<boolean> {
    const idx = sessions.findIndex(s => s.token === token);
    if (idx !== -1) {
      sessions.splice(idx, 1);
      return true;
    }
    return false;
  },
  async invalidateAllForUser(userId: string): Promise<void> {
    for (let i = sessions.length - 1; i >= 0; i--) {
      if (sessions[i].userId === userId) {
        sessions.splice(i, 1);
      }
    }
  },
};

