version: "3.9"

# AI-Fabriek Generated Docker Compose
# Build: clean-final-test
# Generated: 2026-01-06T17:19:17.946Z

networks:
  ai-app-network:
    driver: bridge
    name: ai-app-network

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: ${APP_NAME:-ai-app}-backend
    ports:
      - "${BACKEND_PORT:-3001}:3000"
    environment:
      - PORT=3000
      - NODE_ENV=${NODE_ENV:-production}
      - FRONTEND_URL=http://frontend:80
      - DATABASE_URL=${DATABASE_URL:-}
      - JWT_SECRET=${JWT_SECRET:-dev-secret-CHANGE-IN-PROD}
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - CORS_ORIGIN=${CORS_ORIGIN:-http://localhost:3000}
    networks:
      - ai-app-network
    healthcheck:
      test: ["CMD-SHELL", "wget --no-verbose --tries=1 --spider http://localhost:3000/health || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 40s
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        - NEXT_PUBLIC_API_URL=${NEXT_PUBLIC_API_URL:-http://localhost:3001}
    container_name: ${APP_NAME:-ai-app}-frontend
    ports:
      - "${FRONTEND_PORT:-3000}:80"
    environment:
      - NODE_ENV=${NODE_ENV:-production}
      - NEXT_PUBLIC_API_URL=${NEXT_PUBLIC_API_URL:-http://localhost:3001}
    depends_on:
      backend:
        condition: service_healthy
    networks:
      - ai-app-network
    healthcheck:
      test: ["CMD-SHELL", "wget --no-verbose --tries=1 --spider http://localhost:80 || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 30s
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
